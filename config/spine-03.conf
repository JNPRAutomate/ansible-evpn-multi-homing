
system {
    host-name spine-03;
    time-zone America/Los_Angeles;
    root-authentication {
        encrypted-password "$1$fv3Ke4LT$10nlsy3SEJy5ainm.kPTd.";
    }

    name-server {
        8.8.8.8;
        8.8.4.4;
    }
    services {
        netconf {
            ssh;
        }
        ssh;
    }
    login {
        message "This is the property of Example Corp. Do not login without express permission. ";
    }
    syslog  {
        user * {
            any emergency;
        }
        file messages {
            any notice;
        }
        file cli-commands {
            interactive-commands any;
            explicit-priority;
        }
        time-format millisecond;
    }
    ntp {
        server 129.250.35.250;
    }
}
interfaces {
    em0 {
        unit 0 {
            family inet {
              dhcp;
            }
        }
    }
    em1 {
        unit 0 {
            family inet {
                address 169.254.0.2/24;
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 100.0.0.13/32
            }
        }
    }
}


protocols {
    lldp {
        interface all;
    }
}
/* This block of configuration has been generated by the role overlay-evpn-access for Ansible */


interfaces {
    ae0 {
        description "to customer XX - server YY";
        esi {
            00:01:01:01:01:01:01:01:01:01;
            all-active;
        }
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members [ 101 102 103 104 105 106 107 108];
                }
            }
        }
        aggregated-ether-options {
            lacp {
                active;
                system-id 00:00:00:01:01:01;
            }
        }
    }
    ae1 {
        description "to customer XX - server YY";
        esi {
            00:01:01:01:01:02:02:02:02:02;
            all-active;
        }
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members [ 101 102 103 104 105 106 107 108];
                }
            }
        }
        aggregated-ether-options {
            lacp {
                active;
                system-id 00:00:00:02:02:02;
            }
        }
    }
    xe-0/0/0 {
        description "to leaf-03";
        ether-options {
            802.3ad ae0;
        }
    }
    xe-0/0/1 {
        description "to leaf-03";
        ether-options {
            802.3ad ae0;
        }
    }
    xe-0/0/2 {
        description "to spine-02";
        ether-options {
            802.3ad ae1;
        }
    }
    xe-0/0/3 {
        description "to spine-01";
        ether-options {
            802.3ad ae1;
        }
    }
}

/* This block of configuration has been generated by the role overlay-evpn-qfx-l3 for Ansible */

protocols {
    bgp {
        group overlay-evpn {
            type internal;
            family evpn {
                signaling;
            }
            local-as 65200;
            local-address 100.0.0.13;
            multipath;
            neighbor 100.0.0.11;
        }
        bfd-liveness-detection {
            minimum-interval 350;
            multiplier 3;
            session-mode automatic;
        }
    }
}

protocols {
    evpn {
        encapsulation vxlan;
        extended-vni-list [  9115  9116  9117  9118  9119  9120  9121  9122  9123  9124  9125  9126  9127  9128  9129  9100  9101  9102  9103  9104  9105  9106  9107  9108  9109  9110  9111  9112  9113  9114  ];
        multicast-mode ingress-replication;
        vni-options {
            vni 9115 {
                vrf-target export target:1:9115;
            }
            vni 9116 {
                vrf-target export target:1:9116;
            }
            vni 9117 {
                vrf-target export target:1:9117;
            }
            vni 9118 {
                vrf-target export target:1:9118;
            }
            vni 9119 {
                vrf-target export target:1:9119;
            }
            vni 9120 {
                vrf-target export target:1:9120;
            }
            vni 9121 {
                vrf-target export target:1:9121;
            }
            vni 9122 {
                vrf-target export target:1:9122;
            }
            vni 9123 {
                vrf-target export target:1:9123;
            }
            vni 9124 {
                vrf-target export target:1:9124;
            }
            vni 9125 {
                vrf-target export target:1:9125;
            }
            vni 9126 {
                vrf-target export target:1:9126;
            }
            vni 9127 {
                vrf-target export target:1:9127;
            }
            vni 9128 {
                vrf-target export target:1:9128;
            }
            vni 9129 {
                vrf-target export target:1:9129;
            }
            vni 9100 {
                vrf-target export target:1:9100;
            }
            vni 9101 {
                vrf-target export target:1:9101;
            }
            vni 9102 {
                vrf-target export target:1:9102;
            }
            vni 9103 {
                vrf-target export target:1:9103;
            }
            vni 9104 {
                vrf-target export target:1:9104;
            }
            vni 9105 {
                vrf-target export target:1:9105;
            }
            vni 9106 {
                vrf-target export target:1:9106;
            }
            vni 9107 {
                vrf-target export target:1:9107;
            }
            vni 9108 {
                vrf-target export target:1:9108;
            }
            vni 9109 {
                vrf-target export target:1:9109;
            }
            vni 9110 {
                vrf-target export target:1:9110;
            }
            vni 9111 {
                vrf-target export target:1:9111;
            }
            vni 9112 {
                vrf-target export target:1:9112;
            }
            vni 9113 {
                vrf-target export target:1:9113;
            }
            vni 9114 {
                vrf-target export target:1:9114;
            }
        }
    }
}

routing-options {
    router-id 100.0.0.13;
    forwarding-table {
        ecmp-fast-reroute;
    }
}

routing-instances {
    VRF_TENANT_11 {
        instance-type vrf;
        interface lo0.11;
        interface irb.115;
        interface irb.116;
        interface irb.117;
        interface irb.118;
        interface irb.119;
        interface irb.120;
        interface irb.121;
        interface irb.122;
        interface irb.123;
        interface irb.124;
        interface irb.125;
        interface irb.126;
        interface irb.127;
        interface irb.128;
        interface irb.129;
        route-distinguisher 100.0.0.13:11;
        vrf-target target:10:11;
    }
    VRF_TENANT_10 {
        instance-type vrf;
        interface lo0.10;
        interface irb.100;
        interface irb.101;
        interface irb.102;
        interface irb.103;
        interface irb.104;
        interface irb.105;
        interface irb.106;
        interface irb.107;
        interface irb.108;
        interface irb.109;
        interface irb.110;
        interface irb.111;
        interface irb.112;
        interface irb.113;
        interface irb.114;
        route-distinguisher 100.0.0.13:10;
        vrf-target target:10:10;
    }
}


interfaces {
    irb {
        unit 115 {
            description " * TENANT 11 - vlan 115 - vni 9115 "
            family inet {
                address 100.0.16.2/24 {
                    virtual-gateway-address 100.0.16.1;
                }
            }
        }
        unit 116 {
            description " * TENANT 11 - vlan 116 - vni 9116 "
            family inet {
                address 100.0.17.2/24 {
                    virtual-gateway-address 100.0.17.1;
                }
            }
        }
        unit 117 {
            description " * TENANT 11 - vlan 117 - vni 9117 "
            family inet {
                address 100.0.18.2/24 {
                    virtual-gateway-address 100.0.18.1;
                }
            }
        }
        unit 118 {
            description " * TENANT 11 - vlan 118 - vni 9118 "
            family inet {
                address 100.0.19.2/24 {
                    virtual-gateway-address 100.0.19.1;
                }
            }
        }
        unit 119 {
            description " * TENANT 11 - vlan 119 - vni 9119 "
            family inet {
                address 100.0.20.2/24 {
                    virtual-gateway-address 100.0.20.1;
                }
            }
        }
        unit 120 {
            description " * TENANT 11 - vlan 120 - vni 9120 "
            family inet {
                address 100.0.21.2/24 {
                    virtual-gateway-address 100.0.21.1;
                }
            }
        }
        unit 121 {
            description " * TENANT 11 - vlan 121 - vni 9121 "
            family inet {
                address 100.0.22.2/24 {
                    virtual-gateway-address 100.0.22.1;
                }
            }
        }
        unit 122 {
            description " * TENANT 11 - vlan 122 - vni 9122 "
            family inet {
                address 100.0.23.2/24 {
                    virtual-gateway-address 100.0.23.1;
                }
            }
        }
        unit 123 {
            description " * TENANT 11 - vlan 123 - vni 9123 "
            family inet {
                address 100.0.24.2/24 {
                    virtual-gateway-address 100.0.24.1;
                }
            }
        }
        unit 124 {
            description " * TENANT 11 - vlan 124 - vni 9124 "
            family inet {
                address 100.0.25.2/24 {
                    virtual-gateway-address 100.0.25.1;
                }
            }
        }
        unit 125 {
            description " * TENANT 11 - vlan 125 - vni 9125 "
            family inet {
                address 100.0.26.2/24 {
                    virtual-gateway-address 100.0.26.1;
                }
            }
        }
        unit 126 {
            description " * TENANT 11 - vlan 126 - vni 9126 "
            family inet {
                address 100.0.27.2/24 {
                    virtual-gateway-address 100.0.27.1;
                }
            }
        }
        unit 127 {
            description " * TENANT 11 - vlan 127 - vni 9127 "
            family inet {
                address 100.0.28.2/24 {
                    virtual-gateway-address 100.0.28.1;
                }
            }
        }
        unit 128 {
            description " * TENANT 11 - vlan 128 - vni 9128 "
            family inet {
                address 100.0.29.2/24 {
                    virtual-gateway-address 100.0.29.1;
                }
            }
        }
        unit 129 {
            description " * TENANT 11 - vlan 129 - vni 9129 "
            family inet {
                address 100.0.30.2/24 {
                    virtual-gateway-address 100.0.30.1;
                }
            }
        }
        unit 100 {
            description " * TENANT 10 - vlan 100 - vni 9100 "
            family inet {
                address 100.0.1.2/24 {
                    virtual-gateway-address 100.0.1.1;
                }
            }
        }
        unit 101 {
            description " * TENANT 10 - vlan 101 - vni 9101 "
            family inet {
                address 100.0.2.2/24 {
                    virtual-gateway-address 100.0.2.1;
                }
            }
        }
        unit 102 {
            description " * TENANT 10 - vlan 102 - vni 9102 "
            family inet {
                address 100.0.3.2/24 {
                    virtual-gateway-address 100.0.3.1;
                }
            }
        }
        unit 103 {
            description " * TENANT 10 - vlan 103 - vni 9103 "
            family inet {
                address 100.0.4.2/24 {
                    virtual-gateway-address 100.0.4.1;
                }
            }
        }
        unit 104 {
            description " * TENANT 10 - vlan 104 - vni 9104 "
            family inet {
                address 100.0.5.2/24 {
                    virtual-gateway-address 100.0.5.1;
                }
            }
        }
        unit 105 {
            description " * TENANT 10 - vlan 105 - vni 9105 "
            family inet {
                address 100.0.6.2/24 {
                    virtual-gateway-address 100.0.6.1;
                }
            }
        }
        unit 106 {
            description " * TENANT 10 - vlan 106 - vni 9106 "
            family inet {
                address 100.0.7.2/24 {
                    virtual-gateway-address 100.0.7.1;
                }
            }
        }
        unit 107 {
            description " * TENANT 10 - vlan 107 - vni 9107 "
            family inet {
                address 100.0.8.2/24 {
                    virtual-gateway-address 100.0.8.1;
                }
            }
        }
        unit 108 {
            description " * TENANT 10 - vlan 108 - vni 9108 "
            family inet {
                address 100.0.9.2/24 {
                    virtual-gateway-address 100.0.9.1;
                }
            }
        }
        unit 109 {
            description " * TENANT 10 - vlan 109 - vni 9109 "
            family inet {
                address 100.0.10.2/24 {
                    virtual-gateway-address 100.0.10.1;
                }
            }
        }
        unit 110 {
            description " * TENANT 10 - vlan 110 - vni 9110 "
            family inet {
                address 100.0.11.2/24 {
                    virtual-gateway-address 100.0.11.1;
                }
            }
        }
        unit 111 {
            description " * TENANT 10 - vlan 111 - vni 9111 "
            family inet {
                address 100.0.12.2/24 {
                    virtual-gateway-address 100.0.12.1;
                }
            }
        }
        unit 112 {
            description " * TENANT 10 - vlan 112 - vni 9112 "
            family inet {
                address 100.0.13.2/24 {
                    virtual-gateway-address 100.0.13.1;
                }
            }
        }
        unit 113 {
            description " * TENANT 10 - vlan 113 - vni 9113 "
            family inet {
                address 100.0.14.2/24 {
                    virtual-gateway-address 100.0.14.1;
                }
            }
        }
        unit 114 {
            description " * TENANT 10 - vlan 114 - vni 9114 "
            family inet {
                address 100.0.15.2/24 {
                    virtual-gateway-address 100.0.15.1;
                }
            }
        }
    }
    lo0 {
        unit 11 {
            family inet {
                address 101.0.11.2/32;
            }
        }
    }
    lo0 {
        unit 10 {
            family inet {
                address 101.0.10.2/32;
            }
        }
    }
}

switch-options {
    vtep-source-interface lo0.0;
    vrf-import LEAF-IN;
    vrf-target target:9999:9999;
    route-distinguisher 100.0.0.13:1;
}

policy-options {
     policy-statement LEAF-IN {
        term import_vni9115 {
            from community com9115;
            then accept;
        }
        term import_vni9116 {
            from community com9116;
            then accept;
        }
        term import_vni9117 {
            from community com9117;
            then accept;
        }
        term import_vni9118 {
            from community com9118;
            then accept;
        }
        term import_vni9119 {
            from community com9119;
            then accept;
        }
        term import_vni9120 {
            from community com9120;
            then accept;
        }
        term import_vni9121 {
            from community com9121;
            then accept;
        }
        term import_vni9122 {
            from community com9122;
            then accept;
        }
        term import_vni9123 {
            from community com9123;
            then accept;
        }
        term import_vni9124 {
            from community com9124;
            then accept;
        }
        term import_vni9125 {
            from community com9125;
            then accept;
        }
        term import_vni9126 {
            from community com9126;
            then accept;
        }
        term import_vni9127 {
            from community com9127;
            then accept;
        }
        term import_vni9128 {
            from community com9128;
            then accept;
        }
        term import_vni9129 {
            from community com9129;
            then accept;
        }
        term import_vni9100 {
            from community com9100;
            then accept;
        }
        term import_vni9101 {
            from community com9101;
            then accept;
        }
        term import_vni9102 {
            from community com9102;
            then accept;
        }
        term import_vni9103 {
            from community com9103;
            then accept;
        }
        term import_vni9104 {
            from community com9104;
            then accept;
        }
        term import_vni9105 {
            from community com9105;
            then accept;
        }
        term import_vni9106 {
            from community com9106;
            then accept;
        }
        term import_vni9107 {
            from community com9107;
            then accept;
        }
        term import_vni9108 {
            from community com9108;
            then accept;
        }
        term import_vni9109 {
            from community com9109;
            then accept;
        }
        term import_vni9110 {
            from community com9110;
            then accept;
        }
        term import_vni9111 {
            from community com9111;
            then accept;
        }
        term import_vni9112 {
            from community com9112;
            then accept;
        }
        term import_vni9113 {
            from community com9113;
            then accept;
        }
        term import_vni9114 {
            from community com9114;
            then accept;
        }
        term import_leaf_esi {
            from community comm-leaf_esi;
            then accept;
        }
        term default {
            then reject;
        }
    }
    community comm-leaf_esi members target:9999:9999;
    community com9115 members target:1:9115;
    community com9116 members target:1:9116;
    community com9117 members target:1:9117;
    community com9118 members target:1:9118;
    community com9119 members target:1:9119;
    community com9120 members target:1:9120;
    community com9121 members target:1:9121;
    community com9122 members target:1:9122;
    community com9123 members target:1:9123;
    community com9124 members target:1:9124;
    community com9125 members target:1:9125;
    community com9126 members target:1:9126;
    community com9127 members target:1:9127;
    community com9128 members target:1:9128;
    community com9129 members target:1:9129;
    community com9100 members target:1:9100;
    community com9101 members target:1:9101;
    community com9102 members target:1:9102;
    community com9103 members target:1:9103;
    community com9104 members target:1:9104;
    community com9105 members target:1:9105;
    community com9106 members target:1:9106;
    community com9107 members target:1:9107;
    community com9108 members target:1:9108;
    community com9109 members target:1:9109;
    community com9110 members target:1:9110;
    community com9111 members target:1:9111;
    community com9112 members target:1:9112;
    community com9113 members target:1:9113;
    community com9114 members target:1:9114;
}

vlans {
    bd9115 {
        vlan-id 115;
        l3-interface irb.115;
        vxlan {
            vni 9115;
            ingress-node-replication;
        }
    }
    bd9116 {
        vlan-id 116;
        l3-interface irb.116;
        vxlan {
            vni 9116;
            ingress-node-replication;
        }
    }
    bd9117 {
        vlan-id 117;
        l3-interface irb.117;
        vxlan {
            vni 9117;
            ingress-node-replication;
        }
    }
    bd9118 {
        vlan-id 118;
        l3-interface irb.118;
        vxlan {
            vni 9118;
            ingress-node-replication;
        }
    }
    bd9119 {
        vlan-id 119;
        l3-interface irb.119;
        vxlan {
            vni 9119;
            ingress-node-replication;
        }
    }
    bd9120 {
        vlan-id 120;
        l3-interface irb.120;
        vxlan {
            vni 9120;
            ingress-node-replication;
        }
    }
    bd9121 {
        vlan-id 121;
        l3-interface irb.121;
        vxlan {
            vni 9121;
            ingress-node-replication;
        }
    }
    bd9122 {
        vlan-id 122;
        l3-interface irb.122;
        vxlan {
            vni 9122;
            ingress-node-replication;
        }
    }
    bd9123 {
        vlan-id 123;
        l3-interface irb.123;
        vxlan {
            vni 9123;
            ingress-node-replication;
        }
    }
    bd9124 {
        vlan-id 124;
        l3-interface irb.124;
        vxlan {
            vni 9124;
            ingress-node-replication;
        }
    }
    bd9125 {
        vlan-id 125;
        l3-interface irb.125;
        vxlan {
            vni 9125;
            ingress-node-replication;
        }
    }
    bd9126 {
        vlan-id 126;
        l3-interface irb.126;
        vxlan {
            vni 9126;
            ingress-node-replication;
        }
    }
    bd9127 {
        vlan-id 127;
        l3-interface irb.127;
        vxlan {
            vni 9127;
            ingress-node-replication;
        }
    }
    bd9128 {
        vlan-id 128;
        l3-interface irb.128;
        vxlan {
            vni 9128;
            ingress-node-replication;
        }
    }
    bd9129 {
        vlan-id 129;
        l3-interface irb.129;
        vxlan {
            vni 9129;
            ingress-node-replication;
        }
    }
    bd9100 {
        vlan-id 100;
        l3-interface irb.100;
        vxlan {
            vni 9100;
            ingress-node-replication;
        }
    }
    bd9101 {
        vlan-id 101;
        l3-interface irb.101;
        vxlan {
            vni 9101;
            ingress-node-replication;
        }
    }
    bd9102 {
        vlan-id 102;
        l3-interface irb.102;
        vxlan {
            vni 9102;
            ingress-node-replication;
        }
    }
    bd9103 {
        vlan-id 103;
        l3-interface irb.103;
        vxlan {
            vni 9103;
            ingress-node-replication;
        }
    }
    bd9104 {
        vlan-id 104;
        l3-interface irb.104;
        vxlan {
            vni 9104;
            ingress-node-replication;
        }
    }
    bd9105 {
        vlan-id 105;
        l3-interface irb.105;
        vxlan {
            vni 9105;
            ingress-node-replication;
        }
    }
    bd9106 {
        vlan-id 106;
        l3-interface irb.106;
        vxlan {
            vni 9106;
            ingress-node-replication;
        }
    }
    bd9107 {
        vlan-id 107;
        l3-interface irb.107;
        vxlan {
            vni 9107;
            ingress-node-replication;
        }
    }
    bd9108 {
        vlan-id 108;
        l3-interface irb.108;
        vxlan {
            vni 9108;
            ingress-node-replication;
        }
    }
    bd9109 {
        vlan-id 109;
        l3-interface irb.109;
        vxlan {
            vni 9109;
            ingress-node-replication;
        }
    }
    bd9110 {
        vlan-id 110;
        l3-interface irb.110;
        vxlan {
            vni 9110;
            ingress-node-replication;
        }
    }
    bd9111 {
        vlan-id 111;
        l3-interface irb.111;
        vxlan {
            vni 9111;
            ingress-node-replication;
        }
    }
    bd9112 {
        vlan-id 112;
        l3-interface irb.112;
        vxlan {
            vni 9112;
            ingress-node-replication;
        }
    }
    bd9113 {
        vlan-id 113;
        l3-interface irb.113;
        vxlan {
            vni 9113;
            ingress-node-replication;
        }
    }
    bd9114 {
        vlan-id 114;
        l3-interface irb.114;
        vxlan {
            vni 9114;
            ingress-node-replication;
        }
    }
}
/* This block of configuration has been generated by the role underlay-ebgp for Ansible */

interfaces {
    xe-0/0/4 {
        description " * to spine-02";
        mtu 9192
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.38/31;
            }
        }
    }
    xe-0/0/5 {
        description " * to spine-01";
        mtu 9192
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.35/31;
            }
        }
    }
    xe-0/0/6 {
        description " * to spine-04";
        mtu 9192
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.42/31;
            }
        }
    }
}

protocols {
    bgp {
        log-updown;
        graceful-restart;
        group underlay-ipfabric {
            import bgp-ipclos-in;
            export  bgp-ipclos-out;
            type external;
            mtu-discovery;
            local-as 60013;
            bfd-liveness-detection {
                minimum-interval 350;
                multiplier 3;
                session-mode automatic;
            }
            multipath multiple-as;
            neighbor 172.16.0.39 {
                peer-as 60012;
            }
            neighbor 172.16.0.34 {
                peer-as 60011;
            }
            neighbor 172.16.0.43 {
                peer-as 60014;
            }
        }
    }
}

routing-options {
    router-id 100.0.0.13;
    forwarding-table {
        export pfe-ecmp;
    }
}

policy-options {
    policy-statement pfe-ecmp {
        then {
            load-balance per-packet;
        }
    }
    policy-statement bgp-ipclos-in {
        term loopbacks {
            from {
                route-filter 100.0.0.0/16 orlonger;
            }
            then accept;
        }
    }
    policy-statement bgp-ipclos-out {
        term loopback {
            from {
                protocol direct;
                route-filter 100.0.0.13/32 orlonger;
            }
            then {
                community add MYCOMMUNITY;
                next-hop self;
                accept;
            }
        }
        term as-path {
            from {
                as-path asPathLength2;
                community MYCOMMUNITY;
            }
            then reject;
        }
    }
    as-path asPathLength2 ".{2,}";
    community MYCOMMUNITY members target:12345:111;
}
